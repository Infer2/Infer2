name: Metrics

on:
  schedule:
    - cron: "0 */6 * * *"
  workflow_dispatch:
  push:
    branches: ["master", "main"]

jobs:
  github-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Metrics classic
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: uwu/metrics.classic.svg
          user: Infer2
          template: classic
          base: header, activity, community, repositories, metadata
          config_timezone: Asia/Rangoon
          plugin_repositories: yes
          plugin_repositories_featured: MeteorDevelopment/meteor-client
          plugin_repositories_order: pinned, starred
          plugin_stars: yes
          plugin_stars_limit: 4
          repositories_forks: yes

      - name: Metrics meteor
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: uwu/metrics.meteor.svg
          template: repository
          user: MeteorDevelopment
          repo: meteor-client
          plugin_lines: yes
          plugin_followup: yes

      - name: Metrics kernelsu
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: uwu/metrics.kernalsu.svg
          template: repository
          user: tiann
          repo: KernelSU
          plugin_lines: yes
          plugin_followup: yes

      - name: Metrics calendar
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: uwu/metrics.plugin.isocalendar.fullyear.svg
          base: ""
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year

      - name: Metrics graph
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: uwu/metrics.plugin.graph.svg
          base: ""
          plugin_habits: yes
          plugin_habits_charts: uwu
          plugin_habits_charts_type: graph
          plugin_habits_facts: no
          plugin_habits_trim: yes

      - name: Generate snake
        uses: Platane/snk@v3
        with:
          github_user_name: Infer2
          outputs: |
            uwu/github-snake.svg
            uwu/github-snake-dark.svg?palette=github-dark
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate breakout
        uses: cyprieng/github-breakout@v1
        with:
          github_username: Infer2
          github_token: ${{ secrets.GITHUB_TOKEN }}
          enable_ghost_bricks: false
          output_path: uwu/breakout.svg
          ball_color: grey
          bricks_colors: red

      - name: Publish assets
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./uwu
          publish_branch: uwu
          commit_message: "Update profile assets"
